FROM node:18-alpine

WORKDIR /app

# Installer yarn via corepack
RUN corepack enable && corepack prepare yarn@1.22.22 --activate

# Copier les fichiers de dépendances
COPY package.json ./

# Installer les dépendances
RUN yarn install --frozen-lockfile || yarn install

# Copier le reste de l'application
COPY . .

EXPOSE 3000

# La base de données s'initialise automatiquement au premier appel de l'API
# via ensureDbInitialized() dans app/api/[[...path]]/route.js

CMD ["yarn", "dev"]
